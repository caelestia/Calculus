% to be included
\section{Sheaves}

\newcommand{\etale}{Ã©tale }

\begin{definition}
Fix a topological space $(X,\mathcal{T})$ and endow the open sets in $\mathcal{T}$ with the natural partial order. A \emph{presheaf} of sets (or abelian groups, algebras, ...) on $X$ is a functor $\mathcal{F}:\mathcal{T}^\mathrm{op}\to\mathsf{Set}$ (or $\mathsf{Ab}$, $R-\mathsf{Alg}$, ... respectively). 
The morphisms $\mathcal{F}(U\hookrightarrow V):\mathcal{F}(V)\to\mathcal{F}(U)$ are called \emph{restriction maps}, denoted by $\mathrm{res}_{VU}$. 
\end{definition}

\begin{definition}
A presheaf $\mathcal{F}$ on $X$ is called a \emph{sheaf}, if, for every open cover $\{U_i\subset U\}_{i\in I}$ of $U$, the following conditions hold:
\begin{enumerate}[label=S.\arabic*, series=sheaf]
    \item\label{def.sheaf.1} Locality. If $s, t\in\mathcal{F}(U)$ satisfy $\forall i\in I\ \mathrm{res}_{UU_i}s=\mathrm{res}_{UU_i}t$, then $s=t$.
    \item\label{def.sheaf.2} Gluing property. If the elements $\{s_i\in\mathcal{F}(U_i)\}_i$ are compatible with each other, which means 
    $$\forall i,j\in I,\ \mathrm{res}_{U_iU_i\cap U_j}s_i=\mathrm{res}_{U_jU_i\cap U_j}s_j,$$
    then there exists $s\in\mathcal{F}(U)$ whose restriction to each $U_i$ is $s_i$.
\end{enumerate}
\end{definition}

When difference (and products indeed) are available in the category where our presheaf $\mathcal{F}$ takes value, e.g. $\mathsf{Ab}$, we can rewrite \ref{def.sheaf.1} and \ref{def.sheaf.2} as an exact sequence:

\begin{tikzcd}[row sep=tiny]
    0 \arrow{r} & \mathcal{F}(U) \arrow{r} & \displaystyle\prod_{i\in I}\mathcal{F}(U_i) \arrow{r} & \displaystyle\prod_{i,j\in I}\mathcal{F}(U_i\cap U_j), \\
    & s \arrow[mapsto]{r} & \left(s_i:=\mathrm{res}_{UU_i}s\right)_i \arrow[r, mapsto] & \left(s_i-s_j\right)_{i,j} 
\end{tikzcd}

\noindent where $\{U_i\subset U\}_{i\in I}$ is any open cover of $U$. 

\begin{example}
    By associating to every open set $U$ the same set $A$ and taking $\operatorname{id}_A$ as the restriction map, we obtain the \emph{constant presheaf} $\mathcal{A}$ on $X$ (associated to $A$).
    But in general, if $|A|>1$, a constant presheaf is not a sheaf:
    \begin{itemize}
        \item Take $s\neq t\in A$ and $U=I=\varnothing$, 
        \ref{def.sheaf.1} fails.
        \item \ref{def.sheaf.2} holds.
    \end{itemize}
\end{example}

\begin{remark}
    Notice that this logic applies to any sheaf $\mathcal{F}$ satisfying \ref{def.sheaf.1} and \ref{def.sheaf.2}, hence the property
    \begin{enumerate}[resume*=sheaf]
        \item\label{def.sheaf.3} $|\mathcal{F}(\varnothing)|=1$.
    \end{enumerate}
    holds for any sheaf.
\end{remark}


If we adjust the constant presheaf with \ref{def.sheaf.3}, we'll find that: 
\begin{itemize}
    \item \ref{def.sheaf.1} holds.
    \item It is clear that if $X$ is disconnected then \ref{def.sheaf.2} fails.
    \item Even if $X$ is connected \ref{def.sheaf.2} would not be guaranteed; in fact we would need much more, that there are no disjoint nonempty open sets in $X$.
\end{itemize}

\begin{example}
    The fundamental example of a sheaf is the \emph{sheaf of continuous functions}: $\mathcal{F}(U)=\{U\xrightarrow{\text{continuous}}Y\}$. The restrictions are actual restrictions. \ref{def.sheaf.1} and \ref{def.sheaf.2} can be directly checked.
    
    This is the special case of a \emph{sheaf of sections}. A section of a continuous function $f:E\to X$ on $U$ is a continuous right inverse $\sigma:U\to E$, $f\sigma=\operatorname{id}_U$. Define $\mathcal{F}(U)$ to be the set of sections of $f$ on $U$ and restrictions to be restrictions. \ref{def.sheaf.1} and \ref{def.sheaf.2} can be directly checked.

    Taking $E=X\times Y$ and $f$ the projection to $X$ gives the sheaf of continuous functions to $Y$.
\end{example}

\begin{definition}
    A morphism between presheaves $\mathcal{F}$ and $\mathcal{G}$ is a natural transformation $\mathcal{F}\to\mathcal{G}$, making the presheaves on the space $X$ a category $\mathsf{PreSh}(X)$. The sheaves form a full subcategory $\mathsf{Sh}(X)$.
\end{definition}

\begin{definition}
    Denote the open neighbourhoods of a point $x\in X$ as $\mathcal{N}_x\subset\mathcal{T}^\mathrm{op}$.
    The \emph{stalk} $\mathcal{F}_x$ of a presheaf $\mathcal{F}$ at the point $x$ is an inductive limit
    $$\mathcal{F}_x=\varinjlim_{U\in\mathcal{N}_x}\mathcal{F}(U).$$

    An element $s_x$ of $\mathcal{F}_x$ is called a \emph{germ}, where $s\in\mathcal{F}(U)$ for some $U\in\mathcal{N}_x$.
\end{definition}

A morphism of presheaves $\mathcal{F}\to\mathcal{G}$ induces the local map $\mathcal{F}_x\to\mathcal{G}_x$ at every point $x$.

\begin{definition}
    The \etale space of a presheaf $\mathcal{F}$ is the set
    $$E(\mathcal{F}):=\bigsqcup_{x\in X}\mathcal{F}_x,$$
    with a topology generated by all sets of the form $\tilde s(U):=\{s_x:x\in U\}$, where $s\in\mathcal{F}(U)$. Then we have the natural projection $E(\mathcal{F})\to X$ and the sections $\tilde s:U\xrightarrow{x\mapsto s_x}E(\mathcal{F})$ of it, on every open set $U$ and for every $s\in\mathcal{F}(U)$.

    It remains to prove the continuity of these maps. 
    \begin{itemize}
        \item For the projection, this means showing $\bigsqcup_{x\in U}\mathcal{F}_x$ is open for open $U$, which follows from the definition of the stalk and the topology on the \etale space.
        \item For the sections, we need to show that $\tilde s^{-1}\tilde t(U)$ is open in $X$, where $s,t\in\mathcal{F}(U)$. This is just the set $\{x\in U:s_x=t_x\}$, which is obviously open, for $s_x=t_x$ is equivalent to $s=t$ at some neighbourhood of $x$. 
    \end{itemize}
\end{definition}

\begin{theorem}[Sheafification]\label{sheafification}
    Let $\mathcal{F}$ be a presheaf on $X$. The sheaf of sections of the projection $E(\mathcal{F})\to X$, denoted by $\tilde{\mathcal{F}}$, is called the \emph{sheafification} of $\mathcal{F}$; the terminology resulting from the following adjunction:
    \[ \begin{tikzcd}[column sep=large]
        \mathsf{PreSh}(X) \arrow[r, bend left, "\text{sheafification}"{name=U}] & \mathsf{Sh}(X) \arrow[l, bend left, "\text{forgetful}"{name=D}] \arrow[phantom, from=U, to=D, sloped, "\dashv"]
    \end{tikzcd} \]
    We will verify this, after some preparation:
\end{theorem}

We've already seen the natural morphism from $\mathcal{F}$ to $\tilde{\mathcal{F}}$, given by $s\mapsto\tilde{s}$, which is the unit of the adjunction. 

\begin{theorem}\label{thm.shff.inj}
    A presheaf $\mathcal{F}$ satisfies \ref{def.sheaf.1} if and only if $\mathcal{F}(U)\hookrightarrow\tilde{\mathcal{F}}(U)$ for every open set $U$.
\end{theorem}

\begin{proof}
    $\tilde{s}=\tilde{t}$ on $U$ is the same as $\forall x\in U\ s_x=t_x$; so if $\mathcal{F}$ satisfies \ref{def.sheaf.1}, $s=t$.
    
    The converse should be clear. Indeed, we have this commutative diagram:
    \[ \begin{tikzcd}
        \mathcal{F}(U) \arrow[r] \arrow[d, hook] & \displaystyle\prod_{i\in I}\mathcal{F}(U_i) \arrow[d, start anchor={[yshift=2ex]}] \\
        \tilde{\mathcal{F}}(U) \arrow[r, hook] & \displaystyle\prod_{i\in I}\tilde{\mathcal{F}}(U_i)
    \end{tikzcd} \]
    \noindent where $\{U_i\subset U\}_{i\in I}$ is any open cover of $U$.
    The top arrow must be injective.
\end{proof}

\begin{theorem}\label{thm.shff.iso}
    A presheaf $\mathcal{F}$ is a sheaf if and only if $\mathcal{F}(U)\xrightarrow{\sim}\tilde{\mathcal{F}}(U)$ for every open set $U$.

    In other words, we can equate a sheaf with the continuous sections of its \etale space.
\end{theorem}

\begin{proof}
    We only need to show that $\mathcal{F}$ is a sheaf implies $\mathcal{F}(U)\twoheadrightarrow\tilde{\mathcal{F}}(U)$.

    That is to glue the local information in any continuous section $\sigma:U\to\bigsqcup_{x\in U}\mathcal{F}_x$ into an element of $\mathcal{F}(U)$. For every $x\in U$ we have $\sigma(x)=s_x$ for some $s\in\mathcal{F}(U_x)$ and $U_x\in\mathcal{N}_x$. Continuity of the section $\sigma$ implies that $\{y\in U_x:\sigma(y)=s_y\}$ is open and contains $x$. These sets form an open cover of $U$ and satisfies the conditions of \ref{def.sheaf.2}.
\end{proof}

Above shows that everything about a sheaf can be determined locally. It should not be surprising to have the following result:

\begin{corollary}
    Let $\mathcal{F},\mathcal{G}\in\mathsf{Sh}(X)$. 
    We have the following bijection:
    \begin{lrbox}{\innerdiagram}
        \begin{tikzcd}[column sep=normal]
            \mathcal{F} \arrow[r, "\varphi"] & \mathcal{G}
        \end{tikzcd}
    \end{lrbox}
    \begin{lrbox}{\innerdiagrama}
        \begin{tikzcd}[row sep=tiny, column sep=tiny, baseline=-2ex]
            E(\mathcal{F}) \arrow[rr, "\psi"] \arrow[rd] & & E(\mathcal{G}) \arrow[ld] \\
            & X &
            \arrow[from=1-1, to=1-3, phantom, "\small\text{(commutative in }\small\mathsf{Top})", yshift=-7ex]
        \end{tikzcd}
    \end{lrbox}
    \[ \begin{tikzcd}
       \left\{\usebox{\innerdiagram}\right\} \arrow[d, "1:1", leftrightarrow] \\
        \left\{ \usebox{\innerdiagrama} \right\}
    \end{tikzcd} \]
\end{corollary}

\begin{proof}
    We have explained $\varphi\mapsto\psi$ above. The continuity of $\psi$ can be simply checked: for every open set $U$ and $s\in\mathcal{G}(U)$,
    $$\psi^{-1}(\tilde{s}(U))=\bigcup_{\substack{V\subset U,\\t\in\mathcal{F}(V),\\ \varphi t=s}}\tilde{t}(V).$$

    By Theorem \ref{thm.shff.iso}, sheaves can be equated with sheaves of sections of the \etale space. This gives $\psi\mapsto\varphi=\psi_*$. It is effortless to check that these maps are inverses.
\end{proof}

Now the universal property---the adjuction in Theorem \ref{sheafification}---which defines the sheafification, is easy to verify:

\begin{proof}[Proof of Theorem \ref{sheafification}]
    Let $\mathcal{F}\in\mathsf{PreSh}(X)$ and $\mathcal{G}\in\mathsf{Sh}(X)$. We wish to prove
    \[ \begin{tikzcd}[row sep=3]
        \operatorname{Hom}_{\mathsf{Sh}(X)}(\tilde{\mathcal{F}},\mathcal{G}) \arrow[r, leftrightarrow, "1:1"] & \operatorname{Hom}_{\mathsf{PreSh}(X)}(\mathcal{F},\mathcal{G}), \\
        \varphi \arrow[r, mapsto] & \varphi\circ\left[\mathcal{F}\to\tilde{\mathcal{F}}\right].
    \end{tikzcd} \]

    The other direction is given by
    \[ \begin{tikzcd}[row sep=3, column sep=scriptsize]
        \mathcal{F} \arrow[rr, "\psi"] & & \mathcal{G}, \\
        E(\mathcal{F}) \arrow[rr, "\text{induced by }\psi"] \arrow[rd] && E(\mathcal{G}) \arrow[ld] \\
        & X \arrow[ul, bend left=42, "\text{section}", description]
    \end{tikzcd}, \]
    and $\mathcal{G}\xrightarrow{\sim}\tilde{\mathcal{G}}$.

    To check that these maps are inverses, we claim that
    $$\operatorname{id}_{\tilde{\mathcal{F}}}=\left[\tilde{\mathcal{F}}\xrightarrow{\text{sheafification of }\mathcal{F}}\tilde{\tilde{\mathcal{F}}}\xrightarrow{\sim}\tilde{\mathcal{F}}\right],$$
    where the first map is
    \[ \begin{tikzcd}[row sep=3, column sep=scriptsize]
        \left(\exists s\right)\sigma(x)=s_x \arrow[rr, mapsto, "\because\text{ continuous}"] \arrow[d, "\in", sloped, phantom, description] & & (\tilde{s})_x=\sigma_x \arrow[d, "\in", sloped, phantom, description] \\
        E(\mathcal{F}) \arrow[rr, "\text{sheafification of }\mathcal{F}"] \arrow[rd] & & E(\tilde{\mathcal{F}}) \arrow[ld] \\
        & X \arrow[ul, bend left=35, "\sigma"]
    \end{tikzcd} \]
    The diagram is self-explanatory and proves the claim; from which it is a simple check that $\{\varphi\}\stackrel{1:1}{\longleftrightarrow}\{\psi\}$.
\end{proof}

% TODO constant sheaves

\begin{definition}
    Let $f:X\to Y$ be a continuous function. $\mathsf{Sh}(X)$ and $\mathsf{Sh}(Y)$ are related by $f$, through the following notions:
    \begin{itemize}
        \item The \emph{direct image} $f_*:\mathsf{Sh}(X)\to\mathsf{Sh}(Y)$, defined by
        $$\forall U\subset Y\text{ open},\quad f_*\mathcal{F}(U)=\mathcal{F}(f^{-1}(U)).$$
        
        \item The \emph{inverse image} $f^{-1}:\mathsf{Sh}(Y)\to\mathsf{Sh}(X)$ is the pullback
        \[ \begin{tikzcd}[column sep=small]
            E(f^{-1}\mathcal{G}) \arrow[r] \arrow[d] \arrow[rd, "\Box" description, phantom, pos=0.4] & E(\mathcal{G}) \arrow[d] \\
            X \arrow[r, "f"] & Y 
        \end{tikzcd} \]

        \item When $f:X\hookrightarrow Y$, the pullback is called the \emph{restriction} to $X$, denoted $\mathcal{G}|X$.
    \end{itemize}
\end{definition}

\begin{theorem}
    If $f:X\to Y$ is a continuous map, then
    \[ \begin{tikzcd}[column sep=large]
        \mathsf{Sh}(Y) \arrow[r, bend left, "f^{-1}"{name=U}] & \mathsf{Sh}(X) \arrow[l, bend left, "f_*"{name=D}] \arrow[phantom, from=U, to=D, sloped, "\dashv"]
    \end{tikzcd} \]
    
    Or equivalently, for $\mathcal{F}\in\mathsf{Sh}(X)$ and $\mathcal{G}\in\mathsf{Sh}(Y)$,
    $$\operatorname{Hom}(f^{-1}\mathcal{G},\mathcal{F})\xrightarrow{\sim}\operatorname{Hom}(\mathcal{G},f_*\mathcal{F}).$$
\end{theorem}

\begin{proof}
    Given $\mathcal{G}\xrightarrow{\varphi} f_*\mathcal{F}$, consider $x\in X$ and $U\in\mathcal{N}_{f(x)}$. The natural composition
    $$\mathcal{G}(U)\xrightarrow{\varphi}\mathcal{F}f^{-1}(U)\to\mathcal{F}_x$$
    induces
    $$\mathcal{G}_{f(x)}\xrightarrow{\varinjlim\varphi}\mathcal{F}_x,$$
    evidently giving rise to
    $$E(f^{-1}\mathcal{G})=X\underset{Y}{\times}E(\mathcal{G})\longrightarrow E(\mathcal{F}).$$
    Reversing this process gives the converse.    
\end{proof}

\begin{proposition}
    
\end{proposition}